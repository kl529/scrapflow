# ScrapFlow 아키텍처 문서

## 전체 아키텍처

ScrapFlow는 Electron을 기반으로 한 데스크톱 애플리케이션으로, 메인 프로세스와 렌더러 프로세스로 구성됩니다.

```
┌─────────────────────────────────────────────────┐
│                 Main Process                    │
│  ┌─────────────┐  ┌─────────────┐  ┌──────────┐ │
│  │   main.js   │  │ database.js │  │ preload  │ │
│  │             │  │             │  │          │ │
│  │ - 앱 생명주기 │  │ - SQLite    │  │ - IPC    │ │
│  │ - 글로벌단축키│  │ - 데이터관리  │  │ - 보안   │ │
│  │ - 스크린샷   │  │             │  │          │ │
│  └─────────────┘  └─────────────┘  └──────────┘ │
└─────────────────────────────────────────────────┘
                          │
                    IPC Communication
                          │
┌─────────────────────────────────────────────────┐
│               Renderer Process                  │
│  ┌─────────────────┐  ┌─────────────────────────┐│
│  │   MainWindow    │  │     CommentWindow       ││
│  │                 │  │                         ││
│  │ - 스크랩 관리    │  │ - 스크린샷 코멘트        ││
│  │ - 카테고리 필터  │  │ - 카테고리 선택          ││
│  │ - 날짜 필터     │  │                         ││
│  └─────────────────┘  └─────────────────────────┘│
└─────────────────────────────────────────────────┘
```

## 메인 프로세스 (Main Process)

### 1. main.js
- **역할**: 애플리케이션의 진입점 및 전체 생명주기 관리
- **주요 기능**:
  - Electron 앱 초기화
  - BrowserWindow 생성 및 관리 
  - 글로벌 단축키 등록 (Ctrl+Shift+S)
  - 시스템 트레이 설정
  - 스크린샷 캡처 기능
  - IPC 통신 핸들러

### 2. database.js
- **역할**: SQLite 데이터베이스 관리
- **주요 기능**:
  - 데이터베이스 연결 및 테이블 생성
  - 스크랩 CRUD 작업
  - 카테고리 관리
  - 데이터 필터링 및 정렬

### 3. preload.js
- **역할**: 보안적 IPC 통신 브릿지
- **주요 기능**:
  - contextBridge를 통한 안전한 API 노출
  - 메인 프로세스와 렌더러 프로세스 간 통신

## 렌더러 프로세스 (Renderer Process)

### React 컴포넌트 구조

```
App
├── MainWindow
│   ├── Sidebar
│   │   └── CategoryModal
│   ├── DateFilter
│   └── ScrapGrid
│       └── ScrapCard
└── CommentWindow
    └── CategorySelector
```

### 주요 컴포넌트

#### MainWindow
- 메인 애플리케이션 인터페이스
- 스크랩 목록 표시 및 관리
- 카테고리 및 날짜 필터링

#### CommentWindow  
- 스크린샷 캡처 후 코멘트 입력 팝업
- 카테고리 선택 및 스크랩 저장

#### Sidebar
- 카테고리 목록 표시
- 새 카테고리 생성

#### ScrapGrid & ScrapCard
- 그리드 레이아웃으로 스크랩 표시
- 개별 스크랩 카드 렌더링

## 데이터 플로우

### 스크린샷 캡처 플로우
```
1. 사용자 단축키 입력 (Ctrl+Shift+S)
   ↓
2. Main Process: 스크린샷 캡처
   ↓  
3. Main Process: CommentWindow 생성
   ↓
4. Renderer: 이미지 표시 및 코멘트 입력
   ↓
5. Renderer: 카테고리 선택
   ↓
6. Main Process: 데이터베이스 저장
   ↓
7. 완료 후 MainWindow로 복귀
```

### 데이터 조회 플로우
```
1. Renderer: 스크랩 목록 요청
   ↓
2. Main Process: 데이터베이스 쿼리
   ↓
3. Database: 필터 적용 후 데이터 반환
   ↓
4. Renderer: UI 업데이트
```

## 보안 고려사항

### Context Isolation
- `contextIsolation: true` 설정으로 렌더러 프로세스와 메인 프로세스 분리
- `nodeIntegration: false`로 Node.js API 직접 접근 차단

### Preload Script
- 안전한 API만 렌더러 프로세스에 노출
- IPC 통신 시 데이터 검증

### 파일 시스템 접근
- 스크린샷 파일은 앱 전용 디렉토리에만 저장
- 파일 경로 검증을 통한 경로 순회 공격 방지

## 성능 최적화

### 데이터베이스 최적화
- 인덱스를 통한 쿼리 성능 향상
- 페이지네이션 지원 (필요시)
- 이미지 썸네일 캐싱

### 렌더링 최적화  
- React.memo를 활용한 불필요한 리렌더링 방지
- 이미지 Lazy Loading
- 가상화된 스크롤 (대량 데이터 시)

### 메모리 관리
- 사용하지 않는 이미지 파일 정리
- 데이터베이스 연결 풀링
- 이벤트 리스너 정리

## 확장 가능성

### 플러그인 시스템
- 커스텀 필터 추가
- 외부 서비스 연동 (Notion, Evernote 등)
- 다양한 캡처 모드 지원

### 데이터 동기화
- 클라우드 백업 기능
- 디바이스 간 동기화
- 데이터 내보내기/가져오기

### UI 개선
- 테마 시스템
- 단축키 커스터마이징  
- 레이아웃 개인화